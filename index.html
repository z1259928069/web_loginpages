<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./static/plugins/bootstrap-3.4.1-dist/css/bootstrap.css">
    <style>
        .content {

            margin: 0px auto;
            width: 500px;
            height: 450px;
            background-color: red;
        }
        body {
            background-color: beige;
            /*背景颜色*/
        }
    </style>
</head>

<body>
    <div class="container">
        <div id="app">
            <form>
                <div class="form-group">
                    <label for="username">用户名</label>
                    <input v-model="username" type="text" class="form-control" id="username" placeholder="姓名">
                </div>
                <div class="form-group">
                    <label for="pwd">密码</label>
                    <input type="password" class="form-control" id="pwd" placeholder="密码">
                </div>
            </form>
            <button id="Regist"> <a href="./register.html"> 注册</a></button>
            <button type="submit" id="Login">登陆</button>
            <button><a href="./readme.html" target="_blank">readme.html</a></button>
        </div>
    </div>
    <script src="vue.js"></script>
    <script>
        window.onload = function () {
            //网页加载完毕就运行的
            //注册
            // let btnRegist = document.querySelector("#Regist")
            let btnLogin = document.querySelector("#Login")
            // btnRegist.addEventListener('click', registUser)
            btnLogin.addEventListener('click', LoginUser)
            function checkName(usname, data) {
                console.log("开始查询用户名")
                flag = 0
                for (var i = 0, l = data.length; i < l; i++) {
                    {
                        // console.log(data[i].name)//遍历用data[i][key]， 取值用data[i].name
                        if (data[i].id == usname) {
                            flag = data[i].name;
                            break;
                        }
                    }
                }
                return flag
            }
            function LoginUser() {
                let loginUsername = document.querySelector("#username").value
                let loginPwd = document.querySelector("#pwd").value
                const myHeaders = new Headers()
                myHeaders.append("Content-type", "application/json")
                let requestOptions = {
                    method: "GET",
                    headers: myHeaders,
                    redirect: "follow",
                }
                fetch(`https://db-api.amarea.cn/users`, requestOptions)
                    .then(response => response.json())
                    .then(data => {
                        getName=checkName(loginUsername, data)
                        if (getName) {
                            let flag = checkLogin(data, loginUsername, loginPwd)
                            if (flag) {
                                
                                alert("账号密码登陆成功!")
                                window.location.href = "./loginSuccessfully.html?" + getName
                                // "./loginSuccessfully.html?username="+loginName

                            }
                            else { alert("账号密码输入错误") }
                        }
                        else {
                            console.log("未找到该用户")
                            alert("该用户名不存在，先注册")
                        }
                    })
                    .catch(err => console.log(err))
            }
            function checkLogin(data, loginName, loginPwd) {
                flag = false

                for (let i = 0; i < data.length; i++) {
                    if (data[i].id == loginName && data[i].password == loginPwd) {

                        flag = true
                    }
                }
                return flag
            }
            // function registUser() {
            //     let registerName = document.querySelector("#name").value
            //     let password = document.querySelector("#pwd").value
            //     console.log(registerName)
            //     // console.log(name,password)
            //     const myHeaders = new Headers();
            //     myHeaders.append("Content-Type", "application/json");
            //     const data = { tasks: this.tasks }
            //     let raw = JSON.stringify(data);
            //     // phoneNumber=request.phoneNumber;
            //     // 假如名字重复，拒绝访问
            //     let requestOptions = { // 里面不能有body
            //         method: "GET",
            //         headers: myHeaders,
            //         redirect: "follow",
            //     }
            //     fetch(`https://db-api.amarea.cn/users`, requestOptions)
            //         .then(response => response.json())
            //         .then(data => {
            //             console.log(registerName)
            //             // console.log(data)
            //             //是一个对象(json格式)
            //             // 判断name是否重复1
            //             let flag = checkName(registerName, data)
            //             if (flag) alert("该用户名存在，重新输入");
            //             else {
            //                 console.log("22")
            //                 console.log(registerName, password)
            //                 register(registerName, password)
            //                 alert("注册成功")

            //             }
            //             // console.log(`success: ${data}`);
            //         })
            //         .catch(error => { console.log(`error: ${error}`); });
            // }

            // function register(registerName, pwd) {
            //     const myHeaders = new Headers()
            //     myHeaders.append("Content-Type", "application/json")
            //     let requestOptions = { // 里面不能有body
            //         method: "POST",
            //         headers: myHeaders,
            //         redirect: "follow",
            //     }
            //     requestOptions.body = JSON.stringify({ name: registerName, password: pwd, });
            //     fetch(`https://db-api.amarea.cn/users`, requestOptions)
            //         .then(response => response.json())
            //         .then(data => console.log(data.name))
            //         .catch(err => console.log(err))
            // }
        }

    </script>

</body>

</html>