<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body {
            background-color: beige;
            /*背景颜色*/
        }

        .container {
            box-sizing: content-box;
            /*默认的 content 作为盒子大小*/
            width: 800px;
            /*宽度*/
            height: 500px;
            /*高度*/
            border: 10px ridge lightgray;
            /*边框 10px 桥梁 浅灰色*/
            margin: 50px auto;
            /*外边距 上下50px 左右自动居中*/
            background-color: white;
            /*背景颜色*/
        }

        .child {
            border: 1px solid red;
            /*边框 1px 实线 红色*/
            box-sizing: border-box;
            /*边框作为盒子大小*/
            height: 250px;
            /*高度*/
            border-color: rgba(0, 0, 0, 0);
            /*边框颜色 完全透明*/
        }

        .center {
            margin: 0px auto;
            /*外边距 上下0px 左右自动居中*/
            width: 400px;
            /*宽度*/
            font-family: '楷体';
            /*字体类型*/
            color: gray;
            /*字体颜色*/
        }
        .center table tr {
            height: 50px;
            /*高度*/
        }
        input[type="text"],
        input[type="password"] {
            border: 1px solid lightgray;
            /*边框 1px 实线 浅灰色*/
            width: 180px;
            /*宽度*/
            height: 30px;
            /*高度*/
            border-radius: 15px;
            /*边框圆角*/
            padding: 5px;
            /*填充*/
            box-sizing: border-box;
            /*边框作为盒子大小*/
        }
        input:focus {
            /*输入框获取焦点时*/
            outline: none;
            /*获取焦点时不显示轮廓*/
            border: 1px solid lightskyblue;
            /*边框 1px 实线 浅天蓝色*/
        }
    </style>
</head>

<body>
    <div class="child center">


        <table border="0" align="center">
            <tr>
                <td>用户名</td>
                <td><input type="text" id="username" placeholder="请输入用户名"></td>
            </tr>
            <tr>
                <td>昵称</td>
                <td><input type="text" id="name" placeholder="请输入姓 名"></Gu Yongtd>
            </tr>
            <tr>
                <td>密码</td>
                <td><input id="pwd" type="password" placeholder="请输入密 码"></td>
            </tr>
            <tr>
                <td colspan="2" style=" align : center">
                    <button class="btn " id="Regist">用户注册</button>
                    <button class="btn "  ><a style="text-decoration:none"  href="./index.html">返回</a> </button>
                </td>
            </tr>
        </table>
    </div>

    <script>

        let btnRegist = document.querySelector("#Regist")
        btnRegist.addEventListener('click', registUser)
        function registUser() {
            console.log("开始注册")
            let registerName = document.querySelector("#name").value
            let username = document.querySelector("#username").value
            let password = document.querySelector("#pwd").value
            // console.log(name,password)
            const myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");
            const data = { tasks: this.tasks }
            let raw = JSON.stringify(data);
            // phoneNumber=request.phoneNumber;
            // 假如名字重复，拒绝访问
            let requestOptions = { // 里面不能有body
                method: "GET",
                headers: myHeaders,
                redirect: "follow",
            }
            fetch(`https://db-api.amarea.cn/users`, requestOptions)
                .then(response => response.json())
                .then(data => {
                    // console.log(data)
                    //是一个对象(json格式)
                    // 判断name是否重复1
                    let flag = checkName(registerName, data)
                  
                    if (flag==false) 
                    {alert("该用户名存在，重新输入")}
                    if (flag == true) {
                        register(registerName, username, password)
                        alert("注册成功，即将跳转到登陆界面")
                        setTimeout(() => {
                            console.log("正在跳转");
                        }, 100);
                        window.location.href = "./index.html"

                    }
                    // console.log(`success: ${data}`);
                })
                .catch(error => { console.log(`error: ${error}`); });
        }
        function checkName(usname, data) {
            console.log("开始查询姓名")
            flag = false
            for (var i = 0, l = data.length; i < l; i++) {
                {
                    // console.log(data[i].name)//遍历用data[i][key]， 取值用data[i].name
                    if (data[i].name == usname) {
                        flag = true;
                        break;
                    }
                }
            }
            console.log("flag:" + flag)
            return flag
        }
        function register(registerName, username, pwd) {
            const myHeaders = new Headers()
            myHeaders.append("Content-Type", "application/json")
            let requestOptions = { // 里面不能有body
                method: "POST",
                headers: myHeaders,
                redirect: "follow",
            }
            requestOptions.body = JSON.stringify({ name: registerName, id: username, password: pwd, });
            fetch(`https://db-api.amarea.cn/users`, requestOptions)
                .then(response => response.json())
                .then(data => console.log(data.name))
                .catch(err => console.log(err))
        }
    </script>
</body>

</html>